import { useState } from "react";
import Modal from "@/ui/Modal/Modal";
import { InboxMessageStatus } from "@/components/Inbox/inbox.d";
import Inbox from "@/components/Inbox/Inbox";
import useUser from "@/hooks/useUser";

const InboxIcon = () => {
  const [inboxOpen, setInboxOpen] = useState(false);
  const { inboxMessages } = useUser();
  const unreadMessages = inboxMessages.filter(
    (message) => message.status === InboxMessageStatus.Unread
  );
  const toggleInbox = async () => {
    setInboxOpen(!inboxOpen);
  };

  return (
    <>
      <a href="#inbox" onClick={toggleInbox}>
        <svg
          version="1.0"
          xmlns="http://www.w3.org/2000/svg"
          width="4rem"
          height="4rem"
          role="img"
          aria-label="[Inbox]"
          viewBox="0 0 512.000000 512.000000"
          preserveAspectRatio="xMidYMid meet"
        >
          <metadata>
            Created by potrace 1.16, written by Peter Selinger 2001-2019
          </metadata>
          {unreadMessages.length && (
            <circle
              data-testid="unread"
              fill="red"
              stroke="blue"
              stroke-width="1rem"
              fill-opacity="1"
              cx="20rem"
              cy="10rem"
              r="10rem"
            />
          )}
          <g
            transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
            fill="#000000"
            strokeWidth="1.5"
            stroke="currentColor"
          >
            <path
              d="M2450 4330 c-52 -14 -104 -19 -171 -17 -107 2 -134 -9 -169 -66 -40
-65 -16 -180 47 -225 16 -11 48 -26 71 -33 27 -8 53 -24 67 -44 36 -46 57
-138 49 -210 -8 -75 -15 -92 -56 -148 -28 -39 -39 -46 -78 -51 -258 -35 -410
-126 -502 -301 -70 -135 -93 -231 -108 -462 -20 -310 -52 -517 -100 -658 -24
-70 -25 -91 -5 -99 38 -14 80 75 120 252 29 126 41 232 55 467 12 196 29 298
65 388 55 137 128 223 237 278 108 54 148 59 553 59 393 0 496 -8 608 -48 186
-66 325 -243 368 -467 5 -27 14 -151 19 -275 18 -400 54 -611 135 -800 62
-144 109 -211 194 -272 73 -53 81 -64 81 -114 0 -38 -5 -47 -55 -92 -30 -28
-83 -64 -118 -80 -85 -40 -258 -95 -397 -126 -209 -46 -597 -95 -641 -81 -21
7 -49 59 -49 93 0 24 -35 60 -66 68 -32 8 -64 -20 -64 -56 0 -33 -31 -75 -69
-95 -16 -8 -58 -21 -94 -31 l-65 -16 18 -52 c34 -99 76 -154 130 -171 11 -3
20 -13 20 -21 0 -42 -93 -21 -138 30 -17 19 -47 67 -67 105 -53 100 -134 174
-221 201 -36 11 -74 20 -83 20 -9 0 -87 18 -173 39 -264 67 -431 148 -488 238
-43 67 -41 112 10 196 38 63 49 97 32 97 -11 0 -118 -111 -131 -137 -19 -36
-13 -132 10 -180 65 -135 348 -264 738 -337 136 -26 200 -76 257 -203 30 -67
79 -122 129 -144 45 -21 120 -24 162 -8 15 6 71 12 123 13 83 1 102 5 154 30
72 35 122 84 181 176 50 78 75 94 160 104 33 4 126 20 208 36 360 73 611 192
663 315 19 47 18 113 -4 155 -11 19 -47 58 -80 85 -135 109 -216 280 -271 567
-24 128 -29 186 -41 464 -5 122 -16 253 -24 291 -66 310 -261 500 -560 544
-69 10 -79 15 -87 37 -5 14 -25 42 -44 63 -86 95 -47 281 80 382 79 63 97 96
92 169 -6 95 -63 138 -181 138 -36 0 -102 9 -148 20 -102 24 -190 24 -288 0z
m280 -70 c41 -11 106 -20 143 -20 80 0 100 -9 116 -48 18 -44 -6 -93 -68 -137
-60 -43 -116 -128 -132 -200 -6 -28 -10 -83 -7 -122 l4 -71 -36 6 c-47 9 -265
9 -313 0 -38 -7 -39 -7 -32 19 12 49 6 165 -11 219 -22 72 -74 130 -127 145
-61 16 -95 44 -108 89 -10 33 -9 43 5 65 23 35 51 44 127 39 42 -3 91 2 144
15 105 25 201 26 295 1z m91 -682 c80 -35 60 -38 -220 -38 -149 0 -271 2 -271
4 0 8 56 40 85 47 55 15 366 4 406 -13z m109 -2546 c0 -12 -50 -84 -84 -121
-49 -53 -139 -91 -213 -91 -59 0 -63 2 -78 29 -8 17 -37 42 -66 57 -48 27 -79
65 -79 99 0 8 6 15 13 16 6 0 85 1 174 2 135 2 163 0 163 -12 0 -23 -88 -101
-121 -108 -35 -7 -38 -20 -5 -29 59 -14 148 38 186 110 14 25 31 47 40 50 27
7 70 6 70 -2z"
            />
            <path
              d="M2437 4038 c63 -70 87 -228 48 -320 -6 -15 -3 -16 25 -8 18 5 35 11
37 14 13 12 14 93 3 148 -15 78 -40 128 -80 162 -38 32 -61 34 -33 4z"
            />
            <path
              d="M2664 3783 l-21 -71 26 -5 c14 -3 26 -5 27 -4 1 1 -2 36 -5 77 l-6
74 -21 -71z"
            />
            <path
              d="M1406 1872 c-19 -38 -14 -54 10 -30 9 8 14 26 12 39 -3 23 -4 22 -22
-9z"
            />
            <path
              d="M1811 1826 c4 -4 49 -14 100 -21 304 -46 1133 -42 1367 6 83 17 56
21 -59 9 -256 -27 -1054 -23 -1349 6 -36 4 -62 4 -59 0z"
            />
            <path
              d="M1511 1740 c33 -19 169 -51 299 -70 245 -35 434 -43 892 -37 502 6
747 26 880 73 69 23 71 24 66 29 -2 2 -48 -4 -101 -15 -481 -97 -1524 -88
-1972 16 -69 16 -86 17 -64 4z"
            />
            <path
              d="M1590 1631 c33 -24 177 -62 307 -80 450 -65 1187 -52 1503 26 63 16
150 48 150 56 0 2 -35 -4 -77 -14 -247 -59 -562 -83 -1011 -76 -409 6 -541 20
-857 92 -23 5 -26 4 -15 -4z"
            />

            <title>Inbox</title>
            <desc>Icon for opening the inbox</desc>
          </g>
        </svg>
      </a>
      {/* use context api*/}
      {inboxOpen && (
        <Modal>
          <Inbox toggleInbox={toggleInbox} inboxMessages={inboxMessages} />
        </Modal>
      )}
    </>
  );
};

export default InboxIcon;
